
<!-- README.md is generated from README.Rmd. Please edit that file -->

# rcmip6

<!-- badges: start -->

[![Codecov test
coverage](https://codecov.io/gh/eliocamp/rcmip6/branch/main/graph/badge.svg)](https://app.codecov.io/gh/eliocamp/rcmip6?branch=main)
[![R-CMD-check](https://github.com/eliocamp/rcmip6/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/eliocamp/rcmip6/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of rcmip6 is to search and download data from the CMIP6
project.

## Installation

You can install the development version of rcmip6 like so:

``` r
remotes::install_github("eliocamp/rcmip6")
```

## Example

Search models, variables, etcâ€¦ using `cmip_search()`

``` r
library(rcmip6)

query <- list(
  type               = "Dataset",
  replica            = "false",
  latest             = "true",
  variable_id        = "tas",
  project            = "CMIP6",
  frequency          = "mon",                          
  table_id           = "Amon",
  experiment_id      = "historical",
  source_id          = "CanESM5"
)

results <- cmip_search(query)
cmip_info(results)
#> Found 65 results totalling 3252Mb.
```

Sumary of results:

``` r
results |> 
  cmip_simplify() |>   # To keep only the most informative columns
  subset(, select = -full_info) |> 
  head(10) |> 
  knitr::kable()
```

| mip_era | activity_drs | institution_id | source_id | experiment_id | member_id | table_id | variable_id | grid_label | version  | variable_long_name           | datetime_start       | datetime_stop        | nominal_resolution |
|:--------|:-------------|:---------------|:----------|:--------------|:----------|:---------|:------------|:-----------|:---------|:-----------------------------|:---------------------|:---------------------|:-------------------|
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r10i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r7i1p2f1  | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r8i1p2f1  | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r9i1p2f1  | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r23i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r14i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r16i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r17i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r22i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |
| CMIP6   | CMIP         | CCCma          | CanESM5   | historical    | r11i1p2f1 | Amon     | tas         | gn         | 20190429 | Near-Surface Air Temperature | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | 500 km             |

The, download the data. Just as a demonstration, download only the first
result

``` r
cmip_root_set("readme_example")   # Set the root folder where to save files 
options(timeout = 360)            # Kind of important for some reason

files <- cmip_download(results[1])
#> Downloading tas_Amon_CanESM5_historical_r10i1p2f1_gn_185001-201412.nc...
#> Skipping (matching checksum).
```

The files are saved mirroring the source file structure to ensure that
each file is unique.

``` r
cat(system(paste0("tree ", shQuote(cmip_root_get())), intern = TRUE), sep = "\n")
#> [01;34mreadme_example[00m
#> â””â”€â”€ [01;34mCMIP6[00m
#>     â””â”€â”€ [01;34mCMIP[00m
#>         â””â”€â”€ [01;34mCCCma[00m
#>             â””â”€â”€ [01;34mCanESM5[00m
#>                 â””â”€â”€ [01;34mhistorical[00m
#>                     â””â”€â”€ [01;34mr10i1p2f1[00m
#>                         â””â”€â”€ [01;34mAmon[00m
#>                             â””â”€â”€ [01;34mtas[00m
#>                                 â””â”€â”€ [01;34mgn[00m
#>                                     â””â”€â”€ [01;34m20190429[00m
#>                                         â”œâ”€â”€ model.info
#>                                         â”œâ”€â”€ tas_Amon_CanESM5_historical_r10i1p2f1_gn_185001-201412.log
#>                                         â””â”€â”€ tas_Amon_CanESM5_historical_r10i1p2f1_gn_185001-201412.nc
#> 
#> 10 directories, 3 files
```

This structure can be parsed with `cmip_available()`

``` r
cmip_available() |>
  knitr::kable()
```

| id                                                                                         | version  | access                              | activity_drs | activity_id | cf_standard_name | citation_url                                                                                                       | data_node             | data_specs_version | dataset_id_template\_                                                                                                                     | datetime_start       | datetime_stop        | directory_format_template\_                                                                                                                                    | east_degrees | experiment_id | experiment_title                          | frequency | further_info_url                                                               | geo                                                                                   | geo_units    | grid                                                                                                        | grid_label | index_node         | instance_id                                                         | institution_id | latest | master_id                                                 | member_id | mip_era | model_cohort | nominal_resolution | north_degrees | number_of_aggregations | number_of_files | pid                                               | product      | project | realm | replica |     size | source_id | source_type | south_degrees | sub_experiment_id | table_id | title                                                     | type    | url                                                                                                                                                                                                                                                                       | variable | variable_id | variable_long_name           | variable_units | variant_label | west_degrees | xlink                                                                                                                                                                    |    *version* | retracted | \_timestamp              | score | files                                                                                                                                       |
|:-------------------------------------------------------------------------------------------|:---------|:------------------------------------|:-------------|:------------|:-----------------|:-------------------------------------------------------------------------------------------------------------------|:----------------------|:-------------------|:------------------------------------------------------------------------------------------------------------------------------------------|:---------------------|:---------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------:|:--------------|:------------------------------------------|:----------|:-------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------|:-------------|:------------------------------------------------------------------------------------------------------------|:-----------|:-------------------|:--------------------------------------------------------------------|:---------------|:-------|:----------------------------------------------------------|:----------|:--------|:-------------|:-------------------|--------------:|-----------------------:|----------------:|:--------------------------------------------------|:-------------|:--------|:------|:--------|---------:|:----------|:------------|--------------:|:------------------|:---------|:----------------------------------------------------------|:--------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:------------|:-----------------------------|:---------------|:--------------|-------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------:|:----------|:-------------------------|------:|:--------------------------------------------------------------------------------------------------------------------------------------------|
| CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429\|crd-esgf-drc.ec.gc.ca | 20190429 | HTTPServer, GridFTP , OPENDAP , LAS | CMIP         | CMIP        | air_temperature  | <http://cera-www.dkrz.de/WDCC/meta/CMIP6/CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429.json> | crd-esgf-drc.ec.gc.ca | 01.00.29           | %(mip_era)s.%(activity_drs)s.%(institution_id)s.%(source_id)s.%(experiment_id)s.%(member_id)s.%(table_id)s.%(variable_id)s.%(grid_label)s | 1850-01-16T12:00:00Z | 2014-12-16T12:00:00Z | %(root)s/%(mip_era)s/%(activity_drs)s/%(institution_id)s/%(source_id)s/%(experiment_id)s/%(member_id)s/%(table_id)s/%(variable_id)s/%(grid_label)s/%(version)s |     357.1875 | historical    | all-forcing simulation of the recent past | mon       | <https://furtherinfo.es-doc.org/CMIP6.CCCma.CanESM5.historical.none.r10i1p2f1> | ENVELOPE(-180.0, -2.8125, 87.8638, -87.8638), ENVELOPE(0.0, 180.0, 87.8638, -87.8638) | degrees_east | T63L49 native atmosphere, T63 Linear Gaussian Grid; 128 x 64 longitude/latitude; 49 levels; top level 1 hPa | gn         | esgf-node.llnl.gov | CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429 | CCCma          | TRUE   | CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn | r10i1p2f1 | CMIP6   | Registered   | 500 km             |       87.8638 |                      2 |               1 | hdl:21.14100/5acc469d-b400-3c06-b1de-3f4142d90fc9 | model-output | CMIP6   | atmos | FALSE   | 52462806 | CanESM5   | AOGCM       |      -87.8638 | none              | Amon     | CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn | Dataset | <a                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     href="http://crd-esgf-drc.ec.gc.ca/thredds/catalog/esgcet/169/CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429.xml#CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429&amp;#124;application/xml+thredds&amp;#124;THREDDS"               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     class="uri">http://crd-esgf-drc.ec.gc.ca/thredds/catalog/esgcet/169/CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429.xml#CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429&amp;#124;application/xml+thredds&amp;#124;THREDDS</a>, <a  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     href="http://crd-esgf-drc.ec.gc.ca/las/getUI.do?catid=2D7D52D9ABAF43CDC673C1D95DCBF3BC_ns_CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429&amp;#124;application/las&amp;#124;LAS"                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     class="uri">http://crd-esgf-drc.ec.gc.ca/las/getUI.do?catid=2D7D52D9ABAF43CDC673C1D95DCBF3BC_ns_CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429&amp;#124;application/las&amp;#124;LAS</a>                                                              | tas      | tas         | Near-Surface Air Temperature | K              | r10i1p2f1     |            0 | <a                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         href="http://cera-www.dkrz.de/WDCC/meta/CMIP6/CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429.json&amp;#124;Citation&amp;#124;citation"               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         class="uri">http://cera-www.dkrz.de/WDCC/meta/CMIP6/CMIP6.CMIP.CCCma.CanESM5.historical.r10i1p2f1.Amon.tas.gn.v20190429.json&amp;#124;Citation&amp;#124;citation</a>, <a  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         href="http://hdl.handle.net/hdl:21.14100/5acc469d-b400-3c06-b1de-3f4142d90fc9&amp;#124;PID&amp;#124;pid"                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         class="uri">http://hdl.handle.net/hdl:21.14100/5acc469d-b400-3c06-b1de-3f4142d90fc9&amp;#124;PID&amp;#124;pid</a>                                                         | 1.637114e+18 | FALSE     | 2019-06-23T06:59:01.531Z |     1 | readme_example/CMIP6/CMIP/CCCma/CanESM5/historical/r10i1p2f1/Amon/tas/gn/20190429/tas_Amon_CanESM5_historical_r10i1p2f1_gn_185001-201412.nc |
